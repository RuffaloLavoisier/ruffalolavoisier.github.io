<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="The Hidden Originals - How To Load Application From Encrypt Binary" /><meta property="og:locale" content="en" /><meta name="description" content="Where is the Application Entry Point ?" /><meta property="og:description" content="Where is the Application Entry Point ?" /><link rel="canonical" href="https://ruffalolavoisier.github.io/posts/android_reverse_note_2nd/" /><meta property="og:url" content="https://ruffalolavoisier.github.io/posts/android_reverse_note_2nd/" /><meta property="og:site_name" content="Unforgettable" /><meta property="og:image" content="https://ruffalolavoisier.github.io/assets/img/common/reversing.png" /><meta property="og:image:alt" content="Reverse Engineering of Encrypted DEX" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-11-24T21:36:09+09:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://ruffalolavoisier.github.io/assets/img/common/reversing.png" /><meta name="twitter:image:alt" content="Reverse Engineering of Encrypted DEX" /><meta property="twitter:title" content="The Hidden Originals - How To Load Application From Encrypt Binary" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-11-24T21:36:09+09:00","datePublished":"2025-11-24T21:36:09+09:00","description":"Where is the Application Entry Point ?","headline":"The Hidden Originals - How To Load Application From Encrypt Binary","image":{"lqip":"data:image/webp;base64","alt":"Reverse Engineering of Encrypted DEX","url":"https://ruffalolavoisier.github.io/assets/img/common/reversing.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ruffalolavoisier.github.io/posts/android_reverse_note_2nd/"},"url":"https://ruffalolavoisier.github.io/posts/android_reverse_note_2nd/"}</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2677268060283942" crossorigin="anonymous"></script><title>The Hidden Originals - How To Load Application From Encrypt Binary | Unforgettable</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Unforgettable"><meta name="application-name" content="Unforgettable"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js,npm/mermaid@11.4.0/dist/mermaid.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> <script>mermaid.initialize({startOnLoad:true});</script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://ruffalolavoisier.github.io/assets/img/profile/profile_new.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Unforgettable</a><p class="site-subtitle fst-italic mb-0">I wonder Why I wonder</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/project/" class="nav-link"> <i class="fa-fw fas fa-laptop-code"></i> <span>PROJECT</span> </a><li class="nav-item"> <a href="/interest/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>INTEREST</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/RuffaloLavoisier" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['RuffaloLavoisier','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://stackoverflow.com/users/17522538/ruffalo" aria-label="stack-overflow" target="_blank" rel="noopener noreferrer" > <i class="fab fa-stack-overflow"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>The Hidden Originals - How To Load Application From Encrypt Binary</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip><b>The Hidden Originals - How To Load Application From Encrypt Binary</b></h1><i></i><p class="post-desc fw-light mb-4">Where is the Application Entry Point ?</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1763987769" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 24, 2025 </time> </span><div class="mt-3 mb-3"> <a href="https://ruffalolavoisier.github.io/assets/img/common/reversing.png" class="popup img-link preview-img blur"><img data-src="https://ruffalolavoisier.github.io/assets/img/common/reversing.png" alt="Reverse Engineering of Encrypted DEX" width="1200" height="630" data-lqip="true" src="data:image/webp;base64"></a><figcaption class="text-center pt-2 pb-2">Reverse Engineering of Encrypted DEX</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/RuffaloLavoisier">Ruffalo</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4224 words" > <em>23 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">The Hidden Originals - How To Load Application From Encrypt Binary</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">The Hidden Originals - How To Load Application From Encrypt Binary</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>이전에 <a href="../android_reverse_note">The Hidden Originals - How Protection Layers Conceal Apps</a> 에서 분석하던 <code class="language-plaintext highlighter-rouge">6ded4cf6cc4f4735b954ec4a7becbb99f3d9654710ebc12ffe76c4e0ae396651</code> 파일에 대하여 이어서 분석해보려고 한다.</p><p>이번에는 해당 앱을 보호화고 있는 메커니즘을 뚫고 첫 시작점을 찾아보려고 한다. 이를 위해서는 해당 앱을 리버싱으로부터 원본 앱을 보호하고 있는 보호솔루션 파악이 필요하다.</p><p>아래는 지난 번에 분석하던 부분를 리마인드 차 기록한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">arm</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Application</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.SystemClock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Array</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StubApp</span> <span class="kd">extends</span> <span class="nc">Application</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="no">MAIN_APPLICATION</span><span class="o">;</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">"arm_protect"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>  <span class="c1">// android.content.ContextWrapper</span>
    <span class="kd">protected</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">attachBaseContext</span><span class="o">(</span><span class="nc">Context</span> <span class="n">arg1</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>  <span class="c1">// android.content.ContextWrapper</span>
    <span class="kd">public</span> <span class="kd">native</span> <span class="nc">Context</span> <span class="nf">createPackageContext</span><span class="o">(</span><span class="nc">String</span> <span class="n">arg1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">arg2</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>  <span class="c1">// android.content.ContextWrapper</span>
    <span class="kd">public</span> <span class="kd">native</span> <span class="nc">String</span> <span class="nf">getPackageName</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 주어진 Dex 파일 목록을 현재 ClassLoader의 pathList.dexElements에 동적으로 병합하여 런타임에 추가로 로드하고 소요 시간을 출력합니다.
     */</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">loadDex</span><span class="o">(</span><span class="nc">List</span> <span class="n">list0</span><span class="o">,</span> <span class="nc">Context</span> <span class="n">context0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">v</span> <span class="o">=</span> <span class="nc">SystemClock</span><span class="o">.</span><span class="na">currentThreadTimeMillis</span><span class="o">();</span>
            <span class="nc">StubApp</span><span class="o">.</span><span class="na">MAIN_APPLICATION</span> <span class="o">=</span> <span class="nc">StubApp</span><span class="o">.</span><span class="na">loadMainApplicationFromAssets</span><span class="o">(</span><span class="n">context0</span><span class="o">);</span>
            <span class="nc">Field</span> <span class="n">field0</span> <span class="o">=</span> <span class="o">((</span><span class="nc">Class</span><span class="o">)</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">context0</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">().</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSuperclass</span><span class="o">())).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">"pathList"</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(!</span><span class="n">field0</span><span class="o">.</span><span class="na">isAccessible</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">field0</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nc">Object</span> <span class="n">object0</span> <span class="o">=</span> <span class="n">field0</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">context0</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">());</span>
            <span class="nc">Field</span> <span class="n">field1</span> <span class="o">=</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">object0</span><span class="o">).</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">"dexElements"</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(!</span><span class="n">field1</span><span class="o">.</span><span class="na">isAccessible</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">field1</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nc">Object</span><span class="o">[]</span> <span class="n">arr_object</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[])</span><span class="n">field1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">object0</span><span class="o">);</span>
            <span class="nc">Method</span> <span class="n">method0</span> <span class="o">=</span> <span class="n">object0</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">"makePathElements"</span><span class="o">,</span> <span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">File</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(!</span><span class="n">method0</span><span class="o">.</span><span class="na">isAccessible</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">method0</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nc">Object</span><span class="o">[]</span> <span class="n">arr_object1</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[])</span><span class="n">method0</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">object0</span><span class="o">,</span> <span class="n">list0</span><span class="o">,</span> <span class="n">context0</span><span class="o">.</span><span class="na">getDir</span><span class="o">(</span><span class="s">"arm"</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">());</span>
            <span class="nc">Object</span><span class="o">[]</span> <span class="n">arr_object2</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[])</span><span class="nc">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(((</span><span class="nc">Class</span><span class="o">)</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(((</span><span class="nc">Object</span><span class="o">[])</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">arr_object</span><span class="o">)).</span><span class="na">getClass</span><span class="o">().</span><span class="na">getComponentType</span><span class="o">())),</span> <span class="o">((</span><span class="nc">Object</span><span class="o">[])</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">arr_object1</span><span class="o">)).</span><span class="na">length</span> <span class="o">+</span> <span class="n">arr_object</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">arr_object</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">arr_object2</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">arr_object</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">arr_object1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">arr_object2</span><span class="o">,</span> <span class="n">arr_object</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">arr_object1</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
            <span class="n">field1</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">object0</span><span class="o">,</span> <span class="n">arr_object2</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Time taken: "</span> <span class="o">+</span> <span class="o">(</span><span class="nc">SystemClock</span><span class="o">.</span><span class="na">currentThreadTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">v</span><span class="o">)</span> <span class="o">+</span> <span class="s">" ms"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">exception0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">exception0</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// Reads "config.so" into a byte[] and returns it as a String — unsafe (uses available(), single read, no charset); </span>
    <span class="c1">// prefer streaming + explicit charset.</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">loadMainApplicationFromAssets</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">InputStream</span> <span class="n">inputStream0</span> <span class="o">=</span> <span class="n">context0</span><span class="o">.</span><span class="na">getAssets</span><span class="o">().</span><span class="na">open</span><span class="o">(</span><span class="s">"config.so"</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">arr_b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">inputStream0</span><span class="o">.</span><span class="na">available</span><span class="o">()];</span>
            <span class="n">inputStream0</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">arr_b</span><span class="o">);</span>
            <span class="n">inputStream0</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">arr_b</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="nc">IOException</span> <span class="n">iOException0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">iOException0</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>  <span class="c1">// android.app.Application</span>
    <span class="kd">public</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위와 같이 JAVA 코드가 있으며 native 진입점은 attachBaseContext, onCreate, createPackageContext, getPackageName 이렇게 총 4개이다.</p><h2 id="1-attachbasecontext"><span class="me-2">1. attachBaseContext</span><a href="#1-attachbasecontext" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="개요"><span class="me-2">개요</span><a href="#개요" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">attachBaseContext(Context base)</code>는 Android 프레임워크가 컴포넌트(Activity, Application 등)를 생성할 때 가장 먼저 호출되는 초기화 단계의 콜백이다. 이 메서드는 해당 컴포넌트가 내부적으로 사용하는 Base Context를 설정하거나 감싸기 위한 목적으로 사용된다.</p><h3 id="호출-시점"><span class="me-2">호출 시점</span><a href="#호출-시점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><code class="language-plaintext highlighter-rouge">Application</code> 객체 생성 직후, <code class="language-plaintext highlighter-rouge">onCreate()</code>보다 먼저 호출된다.<li>Activity/Service 또한 내부적으로 <code class="language-plaintext highlighter-rouge">attachBaseContext()</code> 호출 이후 <code class="language-plaintext highlighter-rouge">onCreate()</code>가 실행된다.</ul><h3 id="주요-용도"><span class="me-2">주요 용도</span><a href="#주요-용도" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>초기 Context 래핑 및 설정<li>MultiDex 초기화<li>Locale(지역화) 강제 적용<li>커스텀 ClassLoader / 커스텀 Resources 삽입<li>특정 보안·보호 로직의 초기 실행 지점</ul><h3 id="개발-시-유의사항"><span class="me-2">개발 시 유의사항</span><a href="#개발-시-유의사항" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><code class="language-plaintext highlighter-rouge">super.attachBaseContext(base)</code> 호출이 필수이다. 호출하지 않을 경우 Context 체인이 파괴되어 앱이 정상 동작하지 않을 수 있다.<li>앱 시작 단계이므로 무거운 연산 수행은 피하는 것이 좋다.</ul><hr /><h2 id="2-oncreate"><span class="me-2">2. onCreate</span><a href="#2-oncreate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="개요-1"><span class="me-2">개요</span><a href="#개요-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">onCreate()</code>는 Application 및 Activity, Service 등 컴포넌트의 최초 초기화를 담당하는 대표적인 라이프사이클 콜백이다. 이 시점에서 전역 또는 화면 초기화 작업이 이루어진다.</p><h3 id="호출-시점-1"><span class="me-2">호출 시점</span><a href="#호출-시점-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><code class="language-plaintext highlighter-rouge">Application.onCreate()</code>는 앱 프로세스 생성 후, 단 한 번 호출된다.<li>Activity의 경우 <code class="language-plaintext highlighter-rouge">attachBaseContext</code> 다음에 <code class="language-plaintext highlighter-rouge">onCreate()</code>가 호출된다.<li>일부 경우에는 <code class="language-plaintext highlighter-rouge">ContentProvider.onCreate()</code>가 <code class="language-plaintext highlighter-rouge">Application.onCreate()</code>보다 먼저 호출될 수 있다.</ul><h3 id="주요-용도-1"><span class="me-2">주요 용도</span><a href="#주요-용도-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>전역 초기화 (로그 시스템, DI(Container) 초기화, Crash Handler, Analytics 등)<li>Activity UI 구성, Intent 파싱, Fragment 초기화<li>가벼운 리소스 초기화</ul><h3 id="개발-시-유의사항-1"><span class="me-2">개발 시 유의사항</span><a href="#개발-시-유의사항-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>메인 스레드에서 실행되므로 블로킹 작업(디스크 IO, 네트워크, 대규모 계산)은 수행해서는 안 된다.<li>무거운 초기화 작업은 백그라운드 스레드로 분리하는 것이 바람직하다.</ul><hr /><h2 id="3-createpackagecontext"><span class="me-2">3. createPackageContext</span><a href="#3-createpackagecontext" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="개요-2"><span class="me-2">개요</span><a href="#개요-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">Context.createPackageContext(String packageName, int flags)</code>는 특정 패키지의 Context를 생성하여 해당 패키지의 리소스, 코드, 또는 설정에 접근하기 위한 API이다. 다양한 플러그인 구조에서 사용되며, 제한적으로 외부 APK의 코드를 로드하는 데 활용되기도 한다.</p><h3 id="주요-플래그"><span class="me-2">주요 플래그</span><a href="#주요-플래그" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><strong>CONTEXT_INCLUDE_CODE</strong> 해당 패키지의 클래스 로더를 포함하여 코드 로딩을 허용한다.<li><strong>CONTEXT_IGNORE_SECURITY</strong> 일부 보안 제약을 무시한다. 시스템 권한이 요구될 수 있다.</ul><h3 id="사용-목적"><span class="me-2">사용 목적</span><a href="#사용-목적" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>플러그인 시스템: 외부 APK 리소스/코드 사용<li>앱 간 리소스 공유<li>특정 패키지 내부 데이터 접근(허용 범위 내)</ul><h3 id="유의사항"><span class="me-2">유의사항</span><a href="#유의사항" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>외부 코드 로딩은 Android 보안 모델상 제한적이다.<li>지정된 패키지가 없을 경우 <code class="language-plaintext highlighter-rouge">NameNotFoundException</code>이 발생한다.<li>Android 버전이 올라갈수록 보안 정책이 강화되어 사용이 제한될 수 있다.</ul><hr /><h2 id="4-getpackagename"><span class="me-2">4. getPackageName</span><a href="#4-getpackagename" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="개요-3"><span class="me-2">개요</span><a href="#개요-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">getPackageName()</code>은 현재 Context가 속한 앱의 패키지명을 문자열로 반환한다. 이는 앱 식별자 역할을 하기 때문에 다양한 시스템 동작에서 중요한 의미를 가진다.</p><h3 id="활용"><span class="me-2">활용</span><a href="#활용" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>리소스 접근<li>파일 시스템 경로 결정<li>서버 인증 / 라이선스 검증<li>디버깅 로그 또는 시스템 태깅 목적</ul><h3 id="주의사항"><span class="me-2">주의사항</span><a href="#주의사항" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><code class="language-plaintext highlighter-rouge">createPackageContext()</code>로 생성된 Context를 사용할 경우 반환되는 패키지명은 해당 Context가 참조하는 패키지명이다.<li>일부 앱은 패키지명 변조 후 동작하지 않도록 패키지명 기반 무결성 체크를 수행한다.</ul><hr /><h2 id="jni-에서-연결된-메소드"><span class="me-2">JNI 에서 연결된 메소드</span><a href="#jni-에서-연결된-메소드" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://ruffalolavoisier.github.io/assets/img/2025-11-24-android_reverse_note_2nd/2025-11-24-21-52-06.png" class="popup img-link shimmer"><img src="https://ruffalolavoisier.github.io/assets/img/2025-11-24-android_reverse_note_2nd/2025-11-24-21-52-06.png" alt="" loading="lazy"></a></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>.data:000000000003B000 ; ===========================================================================
.data:000000000003B000
.data:000000000003B000 ; Segment type: Pure data
.data:000000000003B000                 AREA .data, DATA, ALIGN=3
.data:000000000003B000                 ; ORG 0x3B000
.data:000000000003B000 off_3B000       DCQ aAttachbasecont     ; DATA XREF: register_ndk_load(_JNIEnv *)+2C↑o
.data:000000000003B000                                         ; register_ndk_load(_JNIEnv *)+34↑o ...
.data:000000000003B000                                         ; "attachBaseContext"
.data:000000000003B008                 DCQ aLandroidConten_0   ; "(Landroid/content/Context;)V"
.data:000000000003B010                 DCQ _Z31native_attachContextBaseContextP7_JNIEnvP8_jobjectS2_ ; native_attachContextBaseContext(_JNIEnv *,_jobject *,_jobject *)
.data:000000000003B018                 DCQ aOncreate           ; "onCreate"
.data:000000000003B020                 DCQ aV                  ; "()V"
.data:000000000003B028                 DCQ _Z15native_onCreateP7_JNIEnvP8_jobject ; native_onCreate(_JNIEnv *,_jobject *)
.data:000000000003B030                 DCQ aGetpackagename     ; "getPackageName"
.data:000000000003B038                 DCQ aLjavaLangStrin_0   ; "()Ljava/lang/String;"
.data:000000000003B040                 DCQ _Z21native_getPackageNameP7_JNIEnvP8_jobject ; native_getPackageName(_JNIEnv *,_jobject *)
.data:000000000003B048                 DCQ aCreatepackagec     ; "createPackageContext"
.data:000000000003B050                 DCQ aLjavaLangStrin_1   ; "(Ljava/lang/String;I)Landroid/content/C"...
.data:000000000003B058                 DCQ _Z27native_createPackageContextP7_JNIEnvP8_jobjectP8_jstringi ; native_createPackageContext(_JNIEnv *,_jobject *,_jstring *,int)
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">libarm_protect.so</code> 에서 연결된 함수들을 위에 처럼 볼 수 있다.</p><h3 id="dynamic-code-load"><span class="me-2">Dynamic Code Load</span><a href="#dynamic-code-load" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>assets 에 있는 dex 파일을 로드하는 과정을 쫓아가려고 한다.</p><p>해당 파일은 일반 dex 파일이 아닌 암호화된 파일로 보여진다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>00000000: 9b9a 87f5 cfcc caff 6ddd 23f9 a526 950d  ........m.#..&amp;..
00000010: ce08 2667 d4fa 095d f8c3 e73c dbe1 b0b5  ..&amp;g...]...&lt;....
00000020: 6f51 72ff 8fff ffff 87a9 cbed ffff ffff  oQr.............
00000030: ffff ffff 4b52 72ff a0f6 feff 8fff ffff  ....KRr.........
00000040: 5eda ffff 13da fbff cfcc ffff 8f43 fbff  ^............C..
00000050: f982 ffff 4fdd f8ff f119 ffff 1ff5 f4ff  ....O...........
00000060: dbe4 ffff afc4 edff 3ff1 87ff 2f60 eaff  ........?.../`..
00000070: 2f60 eaff 2d60 eaff 2360 eaff 0060 eaff  /`..-`..#`...`..
00000080: d75f eaff a85f eaff 8a5f eaff 695f eaff  ._..._..._..i_..
00000090: 4b5f eaff 285f eaff 015f eaff e15e eaff  K_..(_..._...^..
000000a0: be5e eaff 9b5e eaff 665e eaff 2e5e eaff  .^...^..f^...^..
000000b0: ee5d eaff d05d eaff ae5d eaff 825d eaff  .]...]...]...]..
000000c0: 505d eaff 025d eaff da5c eaff b05c eaff  P]...]...\...\..
000000d0: 865c eaff 5d5c eaff 3a5c eaff 065c eaff  .\..]\..:\...\..
000000e0: d75b eaff a15b eaff 6c5b eaff 3a5b eaff  .[...[..l[..:[..
000000f0: 025b eaff ca5a eaff 8e5a eaff 505a eaff  .[...Z...Z..PZ..
00000100: 125a eaff d659 eaff 9a59 eaff 7559 eaff  .Z...Y...Y..uY..
00000110: 4c59 eaff 1f59 eaff d458 eaff 8658 eaff  LY...Y...X...X..
00000120: 3e58 eaff f057 eaff a457 eaff 7457 eaff  &gt;X...W...W..tW..
00000130: 4a57 eaff 1c57 eaff ec56 eaff ba56 eaff  JW...W...V...V..
00000140: 9356 eaff 4556 eaff 0b56 eaff df55 eaff  .V..EV...V...U..
00000150: b055 eaff 8655 eaff 4a55 eaff 0655 eaff  .U...U..JU...U..
00000160: bc54 eaff 5354 eaff 2254 eaff eb53 eaff  .T..ST.."T...S..
00000170: b453 eaff 7e53 eaff 4853 eaff 2a53 eaff  .S..~S..HS..*S..
00000180: 0c53 eaff ee52 eaff d052 eaff ae52 eaff  .S...R...R...R..
00000190: 8c52 eaff 5b52 eaff 2a52 eaff f751 eaff  .R..[R..*R...Q..
000001a0: c451 eaff a751 eaff 8a51 eaff 4f51 eaff  .Q...Q...Q..OQ..
000001b0: 2651 eaff f750 eaff d050 eaff a550 eaff  &amp;Q...P...P...P..
000001c0: 7f50 eaff 5850 eaff 3050 eaff 0850 eaff  .P..XP..0P...P..

{ . . . }

</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">libarm_protect.so</code> 에서 파일을 보면 경로를 조합하여 dex 파일을 로컬로 가져오는것을 볼 수 있다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>  v8 = (*(__int64 (__fastcall **)(__int64, __int64))(*(_QWORD *)a1 + 248LL))(a1, a2);
  v9 = (*(__int64 (__fastcall **)(__int64, __int64, const char *, const char *))(*(_QWORD *)a1 + 264LL))(
         a1,
         v8,
         "getFilesDir",
         "()Ljava/io/File;");
  v10 = _JNIEnv::CallObjectMethod(a1, a2, v9);
  v29 = (*(__int64 (__fastcall **)(__int64, __int64))(*(_QWORD *)a1 + 248LL))(a1, v10);
  v11 = (*(__int64 (__fastcall **)(__int64, __int64, const char *, const char *))(*(_QWORD *)a1 + 264LL))(
          a1,
          v29,
          "getAbsolutePath",
          "()Ljava/lang/String;");
  v12 = _JNIEnv::CallObjectMethod(a1, v10, v11);
  (*(void (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + 1352LL))(a1, v12, 0);
  buildFilePath(filename);
  extractDex(a1, a2, filename);
</pre></table></code></div></div><p>extractDex 로 들어간다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre><td class="rouge-code"><pre>// Extracts and decrypts DEX files from Android assets. Opens asset directory, searches for .dex files containing "classes", decrypts them using XOR 0xFF, and writes to disk.
AAssetManager *__fastcall extractAndDecryptDexFromAssets(
        JNIEnv *jni_env,
        void *java_this_object,
        char *output_dir_path)
{
  
  
  { . . . }


      do {    // Filter for DEX files: must contain both "classes" and ".dex" in filename (e.g., classes.dex, classes2.dex)
        if ( strstr(current_filename, "classes") &amp;&amp; strstr(current_filename, ".dex") )
        {
          result = AAssetManager_open(asset_manager, current_filename, 2);// AAssetManager_open() - Open asset file. Mode 2 = AASSET_MODE_BUFFER (entire file buffered). Returns AAsset pointer
          if ( !result )
            return result;
          output_file = result;
          
          
          { . . . }
          
          
          *(_OWORD *)output_filepath = 0u;
          v27 = 0u;
          buildFilePath((__int64)output_filepath, asset_handle, v14, output_dir_path, current_filename);// Build output filepath by concatenating output_dir_path with current_filename
          read_buffer = qword_3B0C0;
          if ( qword_3B0C0 &gt;= (unsigned __int64)qword_3B0C8 )
          {
            std::vector&lt;std::string&gt;::__emplace_back_slow_path&lt;char (&amp;)[256]&gt;(&amp;dexList, output_filepath);// Add filepath to global dexList vector (slow path for vector reallocation)
          }
          else
          {
            std::string::basic_string&lt;decltype(nullptr)&gt;(qword_3B0C0, output_filepath);
            qword_3B0C0 = read_buffer + 24;
          }
          v17 = fopen(output_filepath, "wb");   // fopen() - Open file for writing in binary mode. Parameters: filename, mode ("wb" = write binary)
          v18 = (int8x16_t *)malloc(0x400u);    // malloc() - Allocate 1024 byte (0x400) buffer for reading/decrypting asset data
          for ( bytes_read = AAsset_read(output_file, v18, 0x400u);
                bytes_read &gt;= 1;
                bytes_read = AAsset_read(output_file, v18, 0x400u) )// AAsset_read() - Read up to 1024 bytes from asset. Returns number of bytes read (0 or -1 on EOF/error)
          {
            if ( (unsigned int)bytes_read &gt; 0x1F )
            {
              v20 = bytes_read &amp; 0xFFFFFFE0;    // DECRYPTION: XOR each byte with 0xFF (bitwise NOT) using SIMD for chunks of 32 bytes
              v21 = v20;
              v22 = v18 + 1;
              do
              {
                v21 -= 32;
                v23 = vmvnq_s8(*v22);           // vmvnq_s8() - ARM NEON instruction: bitwise NOT on 16-byte vector (MVN = move NOT). Processes 2x16=32 bytes per iteration
                v22[-1] = vmvnq_s8(v22[-1]);
                *v22 = v23;
                v22 += 2;
              }
              while ( v21 );
              if ( v20 == bytes_read )
                goto LABEL_16;
            }
            else
            {
              v20 = 0;
            }
            v24 = (char *)v18 + v20;            // Handle remaining bytes (less than 32) that couldn't be processed by SIMD
            v25 = (unsigned int)bytes_read - v20;
            do {
              --v25;                            // XOR remaining bytes individually with 0xFF (bitwise NOT)
              *v24 = ~*v24;
              ++v24;
            } while ( v25 );
LABEL_16:
            fwrite(v18, 1u, bytes_read, v17);   // fwrite() - Write decrypted buffer to file. Parameters: buffer, element_size, count, file_stream
          }
          fclose(v17);                          // fclose() - Close output file handle
          free(v18);                            // free() - Release read buffer memory
          AAsset_close(output_file);            // AAsset_close() - Close asset handle and free associated resources
        }
        result = (AAssetManager *)AAssetDir_getNextFileName(asset_dir);
        current_filename = (const char *)result;
      } while ( result );
    }
  }
  return result;
}
</pre></table></code></div></div><p>assets 에 있는 classes.dex 파일을 가져와서 0XFF 로 XOR 을 하여 fwrite 하는 것을 볼 수 있다. 암호화된 파일을 복호화하는 중요한 부분이다.</p><p>간단하게 hex 표면을 보면서 암호화된 파일 제일 첫 헤더(MAGIC)로 의심되는 부분을 관찰한다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>00000000: 9b9a 87f5 cfcc caff 6ddd 23f9 a526 950d  ........m.#..&amp;..
</pre></table></code></div></div><p>위에 함수를 참고하면서 아래처험 복호화가 가능하다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x9b\x9a\x87\xf5</span><span class="sh">'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">origin</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="p">...</span>     <span class="n">origin</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">d</span> <span class="o">^</span> <span class="mh">0xFF</span><span class="p">)</span>
<span class="bp">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nf">repr</span><span class="p">(</span><span class="nf">chr</span><span class="p">(</span><span class="n">x</span><span class="p">))[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">origin</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">d</span> <span class="n">e</span> <span class="n">x</span> \<span class="n">n</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></table></code></div></div><p>파일 헤더 매직이 복호화가 되었다.</p><p>이번에는 파일 전체를 복호화 진행한다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>00000000: 6465 780a 3033 3500 9222 dc06 5ad9 6af2  dex.035.."..Z.j.
00000010: 31f7 d998 2b05 f6a2 073c 18c3 241e 4f4a  1...+....&lt;..$.OJ
00000020: 90ae 8d00 7000 0000 7856 3412 0000 0000  ....p...xV4.....
00000030: 0000 0000 b4ad 8d00 5f09 0100 7000 0000  ........_...p...
00000040: a125 0000 ec25 0400 3033 0000 70bc 0400  .%...%..03..p...
00000050: 067d 0000 b022 0700 0ee6 0000 e00a 0b00  .}..."..........
00000060: 241b 0000 503b 1200 c00e 7800 d09f 1500  $...P;....x.....
00000070: d09f 1500 d29f 1500 dc9f 1500 ff9f 1500  ................
00000080: 28a0 1500 57a0 1500 75a0 1500 96a0 1500  (...W...u.......
00000090: b4a0 1500 d7a0 1500 fea0 1500 1ea1 1500  ................
000000a0: 41a1 1500 64a1 1500 99a1 1500 d1a1 1500  A...d...........
000000b0: 11a2 1500 2fa2 1500 51a2 1500 7da2 1500  ..../...Q...}...
000000c0: afa2 1500 fda2 1500 25a3 1500 4fa3 1500  ........%...O...
000000d0: 79a3 1500 a2a3 1500 c5a3 1500 f9a3 1500  y...............
000000e0: 28a4 1500 5ea4 1500 93a4 1500 c5a4 1500  (...^...........
000000f0: fda4 1500 35a5 1500 71a5 1500 afa5 1500  ....5...q.......
00000100: eda5 1500 29a6 1500 65a6 1500 8aa6 1500  ....)...e.......
00000110: b3a6 1500 e0a6 1500 2ba7 1500 79a7 1500  ........+...y...
00000120: c1a7 1500 0fa8 1500 5ba8 1500 8ba8 1500  ........[.......
00000130: b5a8 1500 e3a8 1500 13a9 1500 45a9 1500  ............E...
00000140: 6ca9 1500 baa9 1500 f4a9 1500 20aa 1500  l........... ...
00000150: 4faa 1500 79aa 1500 b5aa 1500 f9aa 1500  O...y...........
00000160: 43ab 1500 acab 1500 ddab 1500 14ac 1500  C...............
00000170: 4bac 1500 81ac 1500 b7ac 1500 d5ac 1500  K...............
00000180: f3ac 1500 11ad 1500 2fad 1500 51ad 1500  ......../...Q...
00000190: 73ad 1500 a4ad 1500 d5ad 1500 08ae 1500  s...............

{ . . . }

</pre></table></code></div></div><p>정상적으로 파일이 복호화된 것을 보고 해당 파일을 디컴파일 툴을 통해 열어본다.</p><p>여기서 극 초반에 <a href="../android_reverse_note">The Hidden Originals - How Protection Layers Conceal Apps</a> 확인했던 <code class="language-plaintext highlighter-rouge">MAIN_APPLICATION</code> 을 찾으면 아래처럼 확인할 수 있다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>00000000  63 6F 6D 2E 73 79 73 74 65 6D 2E 6D 79 61 70 70  com.system.myapp
00000010  6C 69 63 61 74 69 6F 6E 2E 4A 76 6D 2E 6A 76 6D  lication.Jvm.jvm
00000020  64 72 65 64                                      dred
</pre></table></code></div></div><p><a href="https://ruffalolavoisier.github.io/assets/img/2025-11-24-android_reverse_note_2nd/2025-12-06-11-18-35.png" class="popup img-link shimmer"><img src="https://ruffalolavoisier.github.io/assets/img/2025-11-24-android_reverse_note_2nd/2025-12-06-11-18-35.png" alt="" loading="lazy"></a></p><p>정상적으로 암호화된 dex 파일을 복호화하여 내부를 열어볼 수 있다.</p><p>해당 암호화 로직은 ELF 파일 안에서 이루어져 웬만한 방법으로 접근하면 복호화가 불가능하지만 다행히 간간한 암호화 로직을 사용하여 로컬로 떨어지는 파일을 유추할 수 있었다.</p><p>이 복호화된 파일을 VT 에서 확인해본다.</p><p><a href="https://ruffalolavoisier.github.io/assets/img/2025-11-24-android_reverse_note_2nd/2025-12-06-16-55-13.png" class="popup img-link shimmer"><img src="https://ruffalolavoisier.github.io/assets/img/2025-11-24-android_reverse_note_2nd/2025-12-06-16-55-13.png" alt="" loading="lazy"></a></p><p>다수의 백신에서 탐지한다.</p><p><a href="https://ruffalolavoisier.github.io/assets/img/2025-11-24-android_reverse_note_2nd/2025-12-06-16-54-54.png" class="popup img-link shimmer"><img src="https://ruffalolavoisier.github.io/assets/img/2025-11-24-android_reverse_note_2nd/2025-12-06-16-54-54.png" alt="" loading="lazy"></a></p><p>현재 해당 블로그를 쓰는 기점(2025/12/6)으로 샘플이 처음 등록된 것을 볼 수 있다.</p><h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>이번 분석을 통해 해당 보호 솔루션이 적용된 악성코드의 내부 구조를 보다 명확히 이해할 수 있었다. 전체적인 보호 기법은 네이티브 레이어에서의 실행 파일 암호화/복호화 흐름을 기반으로 한 전형적인 하이브리드 보호 방식으로 보이며, Java 영역에는 최소한의 코드만 배치하여 공격 표면을 현저히 줄이는 전략을 취하고 있다. 특히 실행 파일을 메모리 상에서 동적으로 복호화한 뒤 곧바로 실행 환경에 주입하는 방식은 흔히 정상적인 상용 보호 솔루션에서도 사용되는 기법이지만, 악성코드 진영에서도 적극적으로 차용하고 있다는 점이 흥미로웠다.</p><p>분석 과정에서 느낀 것은, 이 방식 자체는 충분히 정당한 소프트웨어 보호 솔루션으로 발전시킬 여지가 있다는 것이다. 구조만 놓고 보면 난독화, 무결성 검증, 동적 복호화 등 다양한 보안 요소를 결합하기 용이하며, 특정 플랫폼·환경에 최적화된 보호 엔진을 구축하는 데도 유용하다. 다만 문제는 이러한 기법이 악성코드 보호에 먼저 활용되면서 이미 다수의 백신 엔진에 의해 악성 패턴으로 분류되고 있다는 점이다. 즉, 기술 자체는 중립적임에도 사용자의 목적에 따라 그 평판과 활용 가능성이 달라지는 전형적인 사례라 할 수 있다.</p><p>이번 경험을 계기로, 단순히 코드를 뜯어보는 수준을 넘어 보호 기법 자체의 의도, 적용 방식, 디텍션 트렌드, 그리고 기술적 중립성에 대한 관점을 함께 갖추는 것이 중요함을 다시 느꼈다. 악성코드 제작자들은 보호 기법을 ‘방어’가 아닌 ‘은폐’의 도구로 사용하기 때문에, 동일한 기술이라도 안전한 제품 개발에 적용하는 것과는 전혀 다른 형태의 진화를 보인다. 이 차이를 이해하는 것이 역공학 연구자로서의 통찰을 키우는 데 큰 도움이 된다.</p><p>앞으로는 시간이 날 때마다 보유 중인 다양한 샘플이나 과거에 작성해 둔 PoC들을 주말마다 정기적으로 다시 분석해 보며, 패커/로더/안티 분석 기법의 변화 추세, 그리고 보호 기술의 양면성을 더 넓은 관점에서 살펴보고자 한다. 이러한 반복적인 탐구가 결국 내 역공학 능력을 더 단단히 다져주고, 새로운 보안 솔루션을 설계할 때에도 보다 균형 잡힌 시각을 갖게 해줄 것이라 생각한다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/android/">Android</a>, <a href="/categories/reverse/">Reverse</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a> <a href="/tags/malware/" class="post-tag no-text-decoration" >Malware</a> <a href="/tags/security/" class="post-tag no-text-decoration" >Security</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author. <br>If you find any errors, please let me know by comment or email. Thank you.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The%20Hidden%20Originals%20-%20How%20To%20Load%20Application%20From%20Encrypt%20Binary%20-%20Unforgettable&url=https%3A%2F%2Fruffalolavoisier.github.io%2Fposts%2Fandroid_reverse_note_2nd%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The%20Hidden%20Originals%20-%20How%20To%20Load%20Application%20From%20Encrypt%20Binary%20-%20Unforgettable&u=https%3A%2F%2Fruffalolavoisier.github.io%2Fposts%2Fandroid_reverse_note_2nd%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fruffalolavoisier.github.io%2Fposts%2Fandroid_reverse_note_2nd%2F&text=The%20Hidden%20Originals%20-%20How%20To%20Load%20Application%20From%20Encrypt%20Binary%20-%20Unforgettable" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/malware_analysis_conference_review/">2025 년 Malware Conference 회고 및 사용 기술 리뷰</a><li class="text-truncate lh-lg"> <a href="/posts/android_reverse_note_2nd/">The Hidden Originals - How To Load Application From Encrypt Binary</a><li class="text-truncate lh-lg"> <a href="/posts/interview-review/">인터뷰 리뷰 및 회고</a><li class="text-truncate lh-lg"> <a href="/posts/android_reverse_note/">The Hidden Originals - How Protection Layers Conceal Apps</a><li class="text-truncate lh-lg"> <a href="/posts/dump_unreal_engine/">Reverse Engineering for Unreal Engine</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/android/">Android</a> <a class="post-tag btn btn-outline-primary" href="/tags/research/">Research</a> <a class="post-tag btn btn-outline-primary" href="/tags/develop/">Develop</a> <a class="post-tag btn btn-outline-primary" href="/tags/malware/">Malware</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">Git</a> <a class="post-tag btn btn-outline-primary" href="/tags/blog/">Blog</a> <a class="post-tag btn btn-outline-primary" href="/tags/reverse/">Reverse</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux/">Linux</a> <a class="post-tag btn btn-outline-primary" href="/tags/mobile/">Mobile</a> <a class="post-tag btn btn-outline-primary" href="/tags/software-developer/">Software developer</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/android_reverse_note/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1760541109" data-df="ll" > Oct 16, 2025 </time><h4 class="pt-0 my-2"><b>The Hidden Originals - How Protection Layers Conceal Apps</b></h4><div class="text-muted"><p>How SO Files Work in Software Protection (feat. Vermillion)</p></div></div></a></article><article class="col"> <a href="/posts/unpacking_malware_core_3/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1746420322" data-df="ll" > May 5, 2025 </time><h4 class="pt-0 my-2"><b>악성코드 안에 패킹된 실행파일 뜯어내기</b></h4><div class="text-muted"><p>Reverse Engineering Packed Binaries to Discover Hidden Logic</p></div></div></a></article><article class="col"> <a href="/posts/malware_analysis_a/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1741741443" data-df="ll" > Mar 12, 2025 </time><h4 class="pt-0 my-2"><b>동적으로 로드되는 실행 파일에 대한 고찰 - 1</b></h4><div class="text-muted"><p>Introduction 최근 여러 개의 Malware 를 포함해서 software-protection 이 적용된 앱들을 분석할 기회가 생겼다. Malware 라고 단정 지을 수 없지만 안티 리버싱이 적용된 앱들이 많아 평소보다 분석이 쉽지 않았던 케이스가 많았다. 이러한 목적은 소스코드 방어 목적도 있지만 어떤 의도를 가진 소프트웨어인지 비공개하기 ...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/interview-review/" class="btn btn-outline-primary" aria-label="Older" ><p><b>인터뷰 리뷰 및 회고</b></p></a> <a href="/posts/malware_analysis_conference_review/" class="btn btn-outline-primary" aria-label="Newer" ><p><b>2025 년 Malware Conference 회고 및 사용 기술 리뷰</b></p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/RuffaloLavoisier">Ruffalo</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p><div class='typing'>I'm <STRONG><span class="text"></span></STRONG></div><script> document.addEventListener("DOMContentLoaded", function () { const $text = document.querySelector(".typing .text"); const letters = [ "Developer", "Author", "Creator", "Inventor", "Conductor", "Traveler" ]; const speed = 100; let i = 0; const typing = async () => { const letter = letters[i].split(""); while (letter.length) { await wait(speed); $text.innerHTML += letter.shift(); } await wait(800); remove(); }; const remove = async () => { const letter = letters[i].split(""); while (letter.length) { await wait(speed); letter.pop(); $text.innerHTML = letter.join(""); } i = !letters[i + 1] ? 0 : i + 1; typing(); }; function wait(ms) { return new Promise(res => setTimeout(res, ms)) } setTimeout(typing, 1500); }); </script></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.3.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/android/">Android</a> <a class="post-tag btn btn-outline-primary" href="/tags/research/">Research</a> <a class="post-tag btn btn-outline-primary" href="/tags/develop/">Develop</a> <a class="post-tag btn btn-outline-primary" href="/tags/malware/">Malware</a> <a class="post-tag btn btn-outline-primary" href="/tags/git/">Git</a> <a class="post-tag btn btn-outline-primary" href="/tags/blog/">Blog</a> <a class="post-tag btn btn-outline-primary" href="/tags/reverse/">Reverse</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux/">Linux</a> <a class="post-tag btn btn-outline-primary" href="/tags/mobile/">Mobile</a> <a class="post-tag btn btn-outline-primary" href="/tags/software-developer/">Software developer</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><script> (function () { const origin = 'https://utteranc.es'; const themeMapper = Theme.getThemeMapper('github-light', 'github-dark'); const initTheme = themeMapper[Theme.visualState]; let script = document.createElement('script'); script.src = 'https://utteranc.es/client.js'; script.setAttribute('repo', 'RuffaloLavoisier/ruffalolavoisier.github.io'); script.setAttribute('issue-term', 'pathname'); script.setAttribute('theme', initTheme); script.crossOrigin = 'anonymous'; script.async = true; const $footer = document.querySelector('footer'); $footer.insertAdjacentElement('beforebegin', script); addEventListener('message', (event) => { let newTheme;if (event.source === window && event.data && event.data.id === Theme.ID) { newTheme = themeMapper[Theme.visualState]; const message = { type: 'set-theme', theme: newTheme }; const utterances = document.querySelector('.utterances-frame').contentWindow; utterances.postMessage(message, origin); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
